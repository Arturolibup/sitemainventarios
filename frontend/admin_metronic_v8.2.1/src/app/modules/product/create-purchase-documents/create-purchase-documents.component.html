<div class="d-flex flex-column flex-column-fluid">
  <!--begin::Toolbar-->
  <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
    <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
      <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
        <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">
          Subir Documentos Oficiales de Compra
        </h1>
      </div>
    </div>
  </div>
  <!--end::Toolbar-->

  <!-- Indicador de carga -->
  <div *ngIf="isLoading" class="text-center py-4">
    <span class="spinner-border spinner-border-sm me-2"></span> Cargando datos...
  </div>

  <!--begin::Content-->
  <div id="kt_app_content" class="app-content flex-column-fluid">
    <div id="kt_app_content_container" class="app-container container-xxl">
      <form id="kt_purchase_documents_form" class="form d-flex flex-column gap-7">
        <!-- Sección de Factura -->
        <div class="card card-flush py-4 shadow-sm" style="border: 1px solid #e0e0e0; border-radius: 8px;">
          <div class="card-header bg-light px-6">
            <h2 class="card-title fs-3 fw-bold text-gray-800">Factura Seleccionada</h2>
          </div>
          <div class="card-body pt-4 px-6">
            <div class="row g-5">
              <div class="col-md-6">
                <label class="form-label required fw-semibold text-gray-700">Número de Factura</label>
                <input
                  type="text"
                  [(ngModel)]="invoiceNumber"
                  name="invoiceNumber"
                  class="form-control form-control-solid"
                  placeholder="Número de factura"
                  readonly
                  style="background-color: #f5f5f5; border: 1px solid #d9d9d9;"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Sección de Documentos -->
        <div class="card card-flush py-4 shadow-sm" style="border: 1px solid #e0e0e0; border-radius: 8px;">
          <div class="card-header bg-light px-6">
            <h2 class="card-title fs-3 fw-bold text-gray-800">Documentos Oficiales</h2>
          </div>
          <div class="card-body pt-4 px-6">
            <!-- Subir nuevos documentos -->
            <div class="mb-6">
              <label class="form-label fw-semibold text-gray-700">Subir Documentos (PDF, Imágenes)</label>
              <input
                type="file"
                class="form-control form-control-solid"
                multiple
                (change)="onFileChange($event)"
                accept=".pdf,.jpg,.jpeg,.png"
                style="border: 1px dashed #adb5bd;"
              />
            </div>

            <!-- Tabla de documentos con líneas definidas -->
            <div class="table-responsive" *ngIf="documentPreviews.length">
              <table class="table table-striped table-bordered align-middle" style="border-collapse: separate; border-spacing: 0; border-radius: 8px; overflow: hidden;">
                <thead class="bg-primary text-white">
                  <tr>
                    <th class="fw-semibold py-3 px-4" style="border-bottom: 2px solid #007bff;">Archivo</th>
                    <th class="fw-semibold py-3 px-4" style="border-bottom: 2px solid #007bff; text-align: center;">Vista Previa</th>
                    <th class="fw-semibold py-3 px-4" style="border-bottom: 2px solid #007bff; text-align: center;">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let preview of documentPreviews; let i = index" style="border-bottom: 1px solid #e0e0e0;">
                    <td class="py-3 px-4" style="border-right: 1px solid #e0e0e0;">
                      <span class="text-gray-800 fw-medium">{{ preview.file.name }}</span>
                    </td>
                    <td class="py-3 px-4" style="border-right: 1px solid #e0e0e0; text-align: center;">
                      <div style="display: flex; justify-content: center; align-items: center; min-height: 100px;">
                        <img
                          *ngIf="preview.file.type.startsWith('image/')"
                          [src]="preview.url"
                          style="max-width: 100px; max-height: 100px; border-radius: 4px; object-fit: cover;"
                          alt="Vista previa"
                        />
                        <span
                          *ngIf="!preview.file.type.startsWith('image/')"
                          class="text-muted"
                          style="display: flex; align-items: center;"
                        >
                          <i class="ki-duotone ki-file fs-2 me-2"></i>No hay vista previa
                        </span>
                      </div>
                    </td>
                    <td class="py-3 px-4" style="text-align: center;">
                      <button
                        type="button"
                        class="btn btn-sm btn-danger"
                        (click)="removeDocument(i)"
                        style="padding: 4px 12px;"
                      >
                        Eliminar
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Botones de acción -->
        <div class="d-flex justify-content-end gap-3 mt-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="goBack()"
            [disabled]="isLoading"
            style="padding: 10px 20px;"
          >
            Regresar
          </button>
          <button
            type="button"
            class="btn btn-light"
            (click)="cancel()"
            [disabled]="isLoading"
            style="padding: 10px 20px;"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="saveDocuments()"
            [disabled]="!documentPreviews.length || isLoading"
            style="padding: 10px 20px;"
          >
            <span class="spinner-border spinner-border-sm me-2" *ngIf="isLoading$ | async"></span>
            Guardar Documentos
          </button>
        </div>
      </form>
    </div>
  </div>
  <!--end::Content-->
</div>