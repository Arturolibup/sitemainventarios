<div class="card shadow-sm p-4">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-4">
    <h4 class="fw-bold text-primary m-0">
      <i class="fas fa-clipboard-list me-2"></i>
      Requisiciones por Aprobar
    </h4>

    <div class="d-flex align-items-center gap-3 flex-wrap">
      <div class="position-relative" style="min-width: 260px;">
        <i class="ki-duotone ki-magnifier position-absolute top-50 translate-middle-y ms-4 fs-2 text-gray-500"></i>
      <input type="text" class="form-control form-control-solid" placeholder="Buscar folio, área..."
             (input)="onSearchInput($event)" [value]="term">
      </div>

      <select class="form-select form-select-solid w-150px" [(ngModel)]="selectedYear" (change)="onYearChange()">
        <option [ngValue]="null">Años</option>
        <option *ngFor="let y of [2024,2025,2026,2027]" [ngValue]="y">{{ y }}</option>
      </select>

      <select class="form-select form-select-solid w-200px" [(ngModel)]="selectedMonth" (change)="onMonthChange()">
        <option [ngValue]="null">Meses</option>
        <option *ngFor="let m of months" [ngValue]="m.value">{{ m.label }}</option>
      </select>

      <button class="btn btn-light" (click)="clearFilters()">
        <i class="fas fa-times"></i> Limpiar
      </button>

      <button class="btn btn-outline-primary" routerLink="/dashboard">
        <i class="fa fa-home"></i> Inicio
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3 text-muted">Cargando requisiciones...</p>
  </div>

  <!-- Tabla -->
  <div class="table-responsive" *ngIf="!loading">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Folio</th>
          <th>Área</th>
          <th>Subárea</th>
          <th>Estatus</th>
          <th>Fecha</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of requisitions; trackBy: trackById">
          <td class="fw-bold">#{{ r.id }}</td>
          <td>{{ r.area?.name || '-' }}</td>
          <td>{{ r.subarea?.name || '-' }}</td>
          <td>
            <span class="badge badge-lg" [ngClass]="{
              'bg-warning text-dark': r.status === 'sent',
              'bg-success': r.status === 'approved',
              'bg-secondary': r.status === 'draft'
            }">
              {{ r.status === 'sent' ? 'Pendiente' : r.status === 'approved' ? 'Aprobada' : 'Borrador' }}
            </span>
          </td>
          <td>{{ r.requested_at | date:'dd/MM/yyyy' }}</td>
          <td class="text-center">
            <button class="btn btn-sm btn-primary" (click)="goApprove(r)" title="Revisar y aprobar">
              <i class="fas fa-check-circle"></i> Revisar
            </button>

            <button *ngIf="r.exit_generated" class="btn btn-sm btn-outline-info ms-1" (click)="printDraft(r.id)">
              <i class="fas fa-print"></i>
            </button>

            <button *ngIf="r.exit_status === 'pending_pdf'" class="btn btn-sm btn-outline-success ms-1"
                    (click)="uploadPdf(r.id, r.exit_pdf_path)">
              <i class="fas fa-upload"></i> Subir PDF
            </button>

            <a *ngIf="r.exit_status === 'completed' && r.exit_pdf_url" [href]="r.exit_pdf_url" target="_blank"
               class="btn btn-sm btn-success ms-1">
              <i class="fas fa-file-pdf"></i> Ver
            </a>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Sin datos -->
    <div *ngIf="requisitions.length === 0" class="text-center py-5 text-muted">
      <i class="fas fa-inbox fa-3x mb-3"></i>
      <p>No hay requisiciones pendientes por aprobar.</p>
    </div>
  </div>

  <!-- Paginación -->
  <div class="d-flex justify-content-between align-items-center mt-4" *ngIf="total > pageSize">
    <div class="text-muted small">
      Mostrando {{ ((currentPage - 1) * pageSize) + 1 }} - {{ [currentPage * pageSize, total].slice(-1)[0] }} de {{ total }} requisiciones
    </div>

    <ngb-pagination
      [(page)]="currentPage"
      [pageSize]="pageSize"
      [collectionSize]="total"
      (pageChange)="onPageChange($event)"
      [maxSize]="5"
      [rotate]="true"
      [boundaryLinks]="true">
    </ngb-pagination>
  </div>
</div>



<!--<div class="card shadow-sm p-4">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
    <h4 class="fw-bold m-0">Requisiciones por aprobar.</h4>
    <button class="btn btn-outline-primary me-2" routerLink="/dashboard">
      <i class="fa fa-home me-2"></i>Menú Principal
    </button>

    <div class="d-flex align-items-center gap-2">
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Buscar..."
        (input)="onSearchInput($event)"
      />

      <select class="form-select form-select-sm" [(ngModel)]="selectedYear" (change)="load()">
        <option [ngValue]="null">Año</option>
        <option *ngFor="let y of [2024,2025,2026,2027]" [ngValue]="y">{{ y }}</option>
      </select>

      <select class="form-select form-select-sm" [(ngModel)]="selectedMonth" (change)="load()">
        <option [ngValue]="null">Mes</option>
        <option *ngFor="let m of months" [ngValue]="m.value">{{ m.label }}</option>
      </select>

      <button class="btn btn-light btn-sm" (click)="clearFilters()">Limpiar</button>
    </div>
  </div>

  
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 mb-0">Cargando…</p>
  </div>

  
  <div class="table-responsive" *ngIf="!loading && filtered.length > 0">
    <table class="table table-hover align-middle text-center">
      <thead class="bg-light">
        <tr>
          <th>Num.</th>
          <th>Área</th>
          <th>Subárea</th>
          <th>Estatus</th>
          <th>Solicitada</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of filtered">
          <td>{{ r.id }}</td>
          <td>{{ r.area?.name || '-' }}</td>
          <td>{{ r.subarea?.name || '-' }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'bg-warning': r.status === 'draft',
              'bg-info': r.status === 'sent',
              'bg-success': r.status === 'approved',
              'bg-danger': r.status === 'rejected'
            }">{{ r.status | titlecase }}</span>
          </td>
          <td>{{ r.requested_at | date:'short' }}</td>
          <td class="text-center">
            <button *ngIf="r.status === 'sent'" 
            (click)="goApprove(r)" 
            class="btn btn-sm btn-primary me-1" 
            title="Revisar requisición">
              Revisar
            </button>

            
            <button *ngIf="r.exit_generated && r.exit_status !== 'completed'" 
            (click)="printDraft(r.id)" 
            class="btn btn-sm btn-outline-primary me-1" 
            title="Imprimir borrador">
              Imprimir
            </button>

            <button *ngIf="r.exit_status === 'pending_pdf'" 
            (click)="uploadPdf(r.id, r.exit_pdf_path)" 
            class="btn btn-sm btn-outline-success me-1" title="Subir vale firmado">
              Subir PDF
            </button>

            <a *ngIf="r.exit_status === 'completed' && r.exit_pdf_url" 
            [href]="r.exit_pdf_url" 
            target="_blank" 
            class="btn btn-sm btn-success me-1" 
            title="Ver vale firmado">
              Ver PDF
            </a>

            <span *ngIf="r.exit_status === 'completed' && r.exit_pdf_url"
            class="badge bg-success ms-1">Firmado</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  
  <div *ngIf="!loading && filtered.length === 0" class="text-center py-5 text-muted">
    No hay requisiciones pendientes por aprobar.
  </div>

  
  <ngb-pagination
    *ngIf="total > pageSize"
    [(page)]="currentPage"
    [pageSize]="pageSize"
    [collectionSize]="total"
    (pageChange)="onPageChange($event)"
    class="d-flex justify-content-center mt-3">
  </ngb-pagination>

</div>-->